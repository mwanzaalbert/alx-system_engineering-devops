#!/usr/bin/env bash
# Configures Nginx to run as the nginx user and listen on port 8080.
cp /etc/nginx/nginx.conf /etc/nginx/nginx.conf.bak
awk '{gsub(/user www-data;/,"user nginx;")}1' /etc/nginx/nginx.conf.bak > /etc/nginx/nginx.conf
cp /etc/nginx/sites-available/default /etc/nginx/sites-available/default.bak
awk '{gsub(/listen 80;/,"listen 8080;")}1' /etc/nginx/sites-available/default.bak > /etc/nginx/sites-available/default
useradd -r -d /nonexistent -s /bin/false nginx || true
service nginx restart
